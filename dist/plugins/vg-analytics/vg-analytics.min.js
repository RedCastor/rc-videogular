"use strict";angular.module("com.2fdevs.videogular.plugins.analytics",["angulartics"]).directive("vgAnalytics",["$analytics","VG_STATES",function(e,n){return{restrict:"E",require:"^videogular",scope:{vgTrackInfo:"=?"},link:function(t,a,r,c){var o=null,f=null,s=[];t.API=c,t.trackEvent=function(n){e.eventTrack(n,o)},t.onPlayerReady=function(e){e&&t.trackEvent("ready")},t.onChangeState=function(e){switch(e,e){case n.PLAY:t.vgTrackInfo.events.play&&(t.setValue(t.vgTrackInfo.events.play),t.trackEvent("play"));break;case n.PAUSE:t.vgTrackInfo.events.pause&&(t.setValue(t.vgTrackInfo.events.pause),t.trackEvent("pause"));break;case n.STOP:t.vgTrackInfo.events.stop&&(t.setValue(t.vgTrackInfo.events.stop),t.trackEvent("stop"))}},t.onCompleteVideo=function(e){e&&t.trackEvent("complete")},t.onUpdateTime=function(e){s.length>0&&e>=s[0].jump&&(t.trackEvent("progress "+s[0].percent+"%"),s.shift())},t.updateTrackInfo=function(e){t.vgTrackInfo.category&&(o.category=t.vgTrackInfo.category),t.vgTrackInfo.label&&(o.label=t.vgTrackInfo.label)},t.setValue=function(e){e&&("percent"===e?c.totalTime>1e3?o.value=Math.floor(c.currentTime/c.totalTime*100):o.value=0:"time"===e&&(o.value=Math.floor(c.currentTime/1e3)))},t.addWatchers=function(){if((t.vgTrackInfo.category||t.vgTrackInfo.label)&&(o={},t.updateTrackInfo(t.vgTrackInfo)),t.$watch("vgTrackInfo",t.updateTrackInfo,!0),t.vgTrackInfo.events.ready&&t.$watch(function(){return c.isReady},function(e,n){t.onPlayerReady(e)}),(t.vgTrackInfo.events.play||t.vgTrackInfo.events.pause||t.vgTrackInfo.events.stop)&&t.$watch(function(){return c.currentState},function(e,n){e!==n&&t.onChangeState(e)}),t.vgTrackInfo.events.complete&&t.$watch(function(){return c.isCompleted},function(e,n){t.onCompleteVideo(e)}),t.vgTrackInfo.events.progress){t.$watch(function(){return c.currentTime},function(e,n){t.onUpdateTime(e/1e3)});var e=t.$watch(function(){return c.totalTime},function(n,a){if((f=n/1e3)>0){for(var r=t.vgTrackInfo.events.progress-1,c=Math.floor(f*t.vgTrackInfo.events.progress/100),o=0;o<r;o++)s.push({percent:(o+1)*t.vgTrackInfo.events.progress,jump:(o+1)*c});e()}})}},c.isConfig?t.$watch("API.config",function(){t.API.config&&(t.vgTrackInfo=t.API.config.plugins.analytics,t.addWatchers())}):t.addWatchers()}}}]);